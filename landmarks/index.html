<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <meta window="viewport" content="initial-scale=1.0">
        <title>Landmarks</title>
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=true"></script>
        <link rel="stylesheet" href="landmarks_styles.css" />

        <script>
            var lat = 0, lng = 0;
            var login = "WALLACE_HEATH";

            getLocation();

            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        lat = position.coords.latitude;
                        lng = position.coords.longitude;
                        console.log(lat);
                        console.log(lng);
                        initialize_map();
                        getLandmarks();
                    });
                } else {
                    alert("Geolocation is not supported by your web browser");
                }
            }

            function initialize_map() {

                var my_position = new google.maps.LatLng(lat, lng);
                console.log(my_position);

                var image = {
                    url: "images/user_icon.png",
                    scaledSize: new google.maps.Size(36, 72),
                    //origin: new google.maps.Point(0, 0),
                    //anchor: new google.maps.Point(9, 36)
                };

                var map = new google.maps.Map(document.getElementById("map"),
                            {center: my_position, zoom: 15});
                var marker = new google.maps.Marker({
                    position: my_position,
                    animation: google.maps.Animation.DROP,
                    map: map,
                    icon: image,
                    title: "Here I am!"
                });

                marker.addListener("click", function() {
                    info.open(map, marker);
                });
                var info = new google.maps.InfoWindow({content: "Here I am!"});

            }

            function getLandmarks() {
                var source = "https://defense-in-derpth.herokuapp.com/sendLocation";

                var post = "login=" + login + "&lat=" + lat + "&lng=" + lng;
                console.log(post);

                var request = new XMLHttpRequest();
                request.open("POST", source, true);
                request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

                request.onreadystatechange = function() {
                    if (request.readyState == 4 && request.status == 200) {
                        var raw = request.responseText;
                        var data = JSON.parse(raw);
                        console.log(data);
                    }
                };

                request.send(post);
            }


        </script>

    </head>

    <body onload="initialize_map()">
        <div id="map"></div>
    </body>


</html>